// Operating Systems: sample code  (c) Tomáš Hudec
// Exploits: buffer overflow

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <inttypes.h>

#if __WORDSIZE == 64
	#define PTR "012" PRIxPTR
#else
	#define PTR  "08" PRIxPTR
#endif

#define BUF_SIZE	1

// modify only the following line to execute another() without calling it
// the modification has to work even if the BUF_SIZE is changed
#define BUF_INDEX	0

void another() {
	printf("This is another().\n");
	exit(EXIT_FAILURE);
}

void f() {
	void *buf[BUF_SIZE];
	buf[BUF_INDEX] = another;

	printf("This is f(), the address of another() is: 0x%" PTR "\n", (uintptr_t)another);
}

int main(int argc, char *argv[])
{
	void *stack;

	printf("This is main(), the address on stack is:  0x%" PTR "\n", (uintptr_t)&stack);
	f();
	printf("This is main() after returning from f().\n");
	return EXIT_SUCCESS;
}
